# 数字图像处理课程报告

## 第一章 绪论

### 1.1 基本概念

1. 图像
    定义为二维函数f(x,y),其中，x,y是空间坐标，f(x,y)是点（x,y）的幅值，灰度图像是一个二维灰度（或亮度）函数f(x,y)，彩色图像由三个（如RGB,HSV）二维灰度（或亮度）函数f(x,y)组成

2. 模拟图像
    可用连续函数来描述，其光照位置和光照强度连续变化。

3. 数字图像
    - 空间坐标和灰度（亮度）均用离散的数字（一般是整数）。
    - 由像素组成的二维排列，可以用矩阵表示。
    - 对于单色（灰度）图像而言，每个像素的亮度通常用一个取值为0~255之间的数值来表示，0表示黑，355表示白，其他值表示处于黑白之间的灰度。
    - 彩色图像可以用红绿蓝三元组的二维矩阵来表示，通常每个数值也介于0~255之间，0表示响应基色在像素中没有，而255代表相应的基色在该像素中取得最大值。

4. 离散信号和数字信号的区别：模拟信号经过抽样变成离散信号，对离散信号进行进一步量化变为数字信号。

5. 像素
    具有特定位置(x, y)和幅度f(x, y)的构成数字图像的有限数量的元素。两个特点：位置和幅度。

6. 图像处理
    - 对图像信息进行加工分析和处理，以满足人的视觉心理需要和实际应用或某种目的（如压缩编码或机器识别的）的要求。
    - 数字图像处理：利用计算机对数字图像进行处理。
        - 优点：精度高、再现性好、方法易变、灵活度高。
        - 缺点：处理速度受到硬件限制。不过现在技术可以通过并行处理提高处理速度。
    - 图像处理的三个层次
        - 低级处理：对图像进行加工以改善图像效果，为图像分析做准备。（如图像去噪、图像增强、美颜ps等）。图像 -> 图像
        - 中级处理：对图像中感兴趣的目标进行检测和测量（特征提取），以获得客观的信息。（如提取颜色特征、直方图特征）。图像 -> 特征
        - 高级处理：研究图像中各目标的性质和其相互关系，理解图像的含义。（图像中两个人的关系、无人驾驶）。
    - 实例
        - 低级处理实例：
            - 水平翻转：f(x, y) = f(width - x, y)
            - 垂直翻转：f(x, y) = f(x, height - y)
            - 取反操作：f(x, y) = 255 - f(x, y)
            - 去噪处理：黑点椒噪声，白点盐噪声
            - 图像增强
        - 中级处理实例：
            - 图像分割
        - 高级处理实例：
            - 人脸检测

7. 图像处理机器相关领域

- 计算机视觉：使计算机来模仿人的视觉，包括理解并根据视觉输入采取行动。属于人工只能的一个分支。
- 图像理解：对图像的语义理解。

### 1.2 数字图像处理的起源与发展

- 最早应用：20世纪20年代，第一次通过海底电缆传输图像
- 诞生：20世纪60年代，第一台执行有意义的图像处理任务的大型计算机。
- 开始应用：20世纪60年代末、70年代初，开始用于医学图像、地球资源遥感监测和天文学等领域。
- 广泛应用：至今广泛用于工业、医学、生物科学、地理学、考古学、物理学、天文学等多个领域。
- 解决机器感知问题：
    - 自动字符识别
    - 军事识别
    - X射线和血样分类。

### 1.3 数字图像处理的应用实例
- Gamma射线成像
- X射线成像
- 紫外线成像
- 可见光及红外波段成像
    - 电磁波谱
    - 生产产品的自动视觉检测
    - 识别指纹、纸币、自动读取牌照
- 微波波段成像（雷达）
- 无线电波段成像（核磁共振）
- 其他成像方式
    - 声波图像
    - 超声波成像
    - 电子显微镜成像
    - 计算机合成成像

### 1.4 数字图像处理流程

> 图像获取 -> 图像增强 -> 图像复原 -> 彩色图像处理 -> 小波变换 -> 图像压缩 -> 形态学处理 -> 图像分割 -> 表示与描述 -> 目标识别

1. 图像增强（主观）：突出图像中主观感兴趣的部分，而减弱或去除不需要的信息，从而使有用的信息得到增强，便于区分或解释。

2. 图像恢复（客观）：去除干扰和模糊，恢复图像的本来面目。典型应用：去噪。

3. 图像分割：将图像中包含的物体，按其灰度或几何特性等划分为若干个有意义的区域。

4. 目标识别（以指纹识别为例）：
    - 原始灰度图像
    - 预处理
        - 去噪，增强对比度
    - 图像分割
        - 二值化
        - 细化
    - 特征提取
        - 把数据转换成适合计算机处理以及后续目标识别的形式
    - 进行识别
        - 使用匹配算法

### 1.5 数字图像处理系统组成
- 图像输入
- 图像存储
- 图像通信
- 图像处理和分析
- 图像输出

## 第二章 数字图像基础

### 2.1 视觉感知要素之亮度适应和鉴别

 >人眼对不同亮度和的适应和鉴别能力
    - 亮 -> 暗： 适应快
    - 暗 -> 亮： 适应慢

1. 视觉适应性

- 亮度适应级
    - 是视觉系统当前的灵敏度级别
    - 指的是人眼适应了某一环境后，该环境的平均亮度
- 亮度适应现象
    - 人眼并不能同时在整个范围内工作，而是利用改变灵敏度来实现大的动态范围内的变动
- 主观亮度
    进入人眼的光强度的对数函数

2. 辨别光强度的能力

3. 人眼感觉的亮度
    - 人眼对亮度的对比度敏感，而非对亮度本身敏感
    - 人眼主观感觉的亮度不是简单的取决于光强度。
        - 韦伯-费涅赫尔定理：亮度感觉S与实际亮度B的对比度的对数成线性关系。<font color = 'red'>$ S = k * \ln B + k_0 $</font>
            - 因此，重现景物的亮度范围无需与实际景物的亮度范围相同，只需保持二者的对比度相同。
            - 人眼不能辨别的亮度差别也无需重现出来，只需保持二者的亮度差别级数相同即可。

    - 马赫带效应
        - 一个物体和它周围的亮度的交互作用，产生一种马赫带效应.
        - 视觉系统有趋于过高或过低估计不同亮度区域边界值的效应，这就称为马赫带效应。
        - 虽然边缘亮度恒定，但感觉亮的地方更亮，暗的地方更暗。
    - 同时对比效应
      
        - 人眼对某个区域感觉的亮度（主观亮度）不仅依赖于自身亮度，还与其背景有关。例如一张纸白天看很亮，晚上看很黑。
    - 视觉错觉
      
        - 在错觉中，眼睛填上了不存在的信息或错误地感知了物体的几何特点。

### 2.2 光和电磁波谱

1. 人从物体感受到的颜色由物体反射光决定
    - 若所有反射的可见光波长均衡，则物体显示白色
    - 有颜色的物体是因为物体吸收了其他波长的大部分能量，反射了某段波长范围的光
    - 没有颜色的光叫做单色光或消光，灰度级通常来描述单色光的强度。其范围从黑到灰，最后到白。
2. 彩色光源的三个基本属性
    - 发光强度：从光源流出能量的总量。单位：瓦特
    - 光通量：观察者从光源感受到的能量。单位：流明
    - 亮度：光感受的主观描绘子。（不测能量）

### 2.3 图像的感知和获取

- 图像形成模型：
    - 在特定坐标处，通过传感器转换获得的f值为一正的标量。
    
    - 函数由<font color = "red">入射到观察场景的光源总量</font>和<font color="red">场景中物体反射光的总量组成</font>。
        $ f(x, y) = i(x, y) * r(x, y)  $
      其中f(x, y)介于0到正无穷之间，代表灰度。
      i(x, y)为<font color="blue">入射分量</font>，为白光强度。
      r(x, y)为<font color="blue">反射分量</font>，为平均反射系数。该系数为0时代表全吸收，系数为1时代表全反射。

### 2.4 图像的取样和量化

#### 2.4.1 取样和量化

1. 取样：图像空间坐标的数字化
2. 量化：图像函数值（灰度值）的数字化
    - 黑白图像：只有两个像素值0和1
    - 灰度图像：像素强度[0, 255]区间内
    - 彩色图像：在灰色图像的基础上，有了(R, G, B)三个通道。
3. 种类
    - 均匀采样和量化：等间隔
    - 非均匀采样和量化：灰度级变化尖锐的区域，进行细腻采样，灰度级平滑的区域，用粗糙的采样。
        - 在边界附近使用较少的灰度级
        - 避免画减少由于量化过于粗糙，在灰度级变化交平滑的区域出现假轮廓现象。

#### 2.4.2 数字图像的表示

1. 二维离散亮度函数f(x, y)
    - x, y为图像像素的空间坐标
    - 函数值f(x, y)代表了在点(x, y)处像素的灰度值
2. 二维矩阵A[m, n]
    - m, n代表图像的宽和高
    - 矩阵元素a(i, j)的值，表示图像在第i行，第j列的像素的灰度值；i, j表示几何位置。
3. 三种坐标系
    - 直角坐标系
    - 矩阵坐标系
    - 图像坐标系
4. 存储图像所需比特数: $ b = m * n * k $
   
    - 其中m, n为图像的尺寸
    - k位图像的位数，一个图像有 $2^k$ 个灰度值。

#### 2.4.3 空间和灰度分辨率

1. 空间分辨率（对应采样）
    图像中可分辨的最小细节，主要由采样间隔值决定，采样间隔值玉箫，空间分辨率越高,图像越清晰。

2. 灰度分辨率（对应量化）
    灰度级别中可分辨的最小变化，通常也把灰度级L称为灰度分辨率。

3. 小结
    图像分辨率依赖于M, N和L
    - 保持M * N不变减少L会导致假轮廓
    - 保持L不变减少M * N则会导致棋盘效果
    - 图像质量一般随着M * N和L的增加而增加，但存储量增大。

#### 2.4.4 图像的缩小和放大

1. 图像的收缩：下采样
2. 图像放大
    - 创立新的像素位置
    - 给新像素赋灰度值
        - 最近邻域内插
        - 双线性内插

### 2.5 像素间的基本关系

#### 2.5.1 相邻像素

1. 4邻域
    - (x-1, y) (x+1, y) (x, y-1) (x, y+1)
    - 用$N_4$表示
2. D邻域
    - (x-1, y-1) (x-1, y+1) (x+1, y-1) (x+1, y+1)
    - 用$N_D$表示
3. 8邻域
    - 4邻域和D邻域结合
    - 用$N_8$表示
    - $N_8(p) = N_4(p) + N_D(p)$

#### 2.5.2 邻接性、连通性、区域和边界

###### 一、邻接性

1. 像素相邻：两个像素在位置上相邻，且取值相同或相近
2. 三种类型邻接性：
    - 4邻接
    - 8邻接
    - m邻接（混合邻接）：对于具有值V的像素p和q
3. 4邻接必8邻接，反之不一定成立
4. m邻接
    - 对于具有像素值V的像素p和q，如果
        - q在集合$N_4(p)$中，或q在$N_D(q)$中
        - 并且$N_4(p)$和$N_4(q)$的交集为空(没有值V的像素)
    - 则称这两个像素是m连通的
    - 意义：消除8连接的二义性

##### 二、连通性

1. 通路
    像素$p(x_0, y_0)$到像素$q(x_n, y_n)$的通路定义为特定的像素序列: $(x_0, y_0), (x_1, y_1), (x_2, y_2), ..., (x_n, y_n)$，
    其中$(x_i, y_i)$和$(x_{i-1}, y_{i-1})$对于(1=< i <= n)是邻接的。n是通路长度。若起点和终点为同一个点，则通路是闭合通路。

2. 连通性
    若S是图像的一个像素子集，$\forall p, q \in S$，如果存在一条由S中像素组成从p到q的通路，则称p在图像集S中与q连通，连通也分为4连通和8连通。
    - 连通分量: $\forall p \in S$，$S$中连通到p的像素点的集合。
    - 连通集：如果S中仅有一个连通分量，则S叫连通集

##### 三、区域和边界

1. 区域
    R是图像中的像素子集，若R是连通集，则称R是一个区域。

2. 邻接区域
    两个区域，如果合并为一个区域，则称这两个区域为邻接区域。
    <font color='red'>注：定义邻接区域时，必须知名灰度相似性准则V={}和邻接类型</font>

3. 区域的边界
    假设图像中由K个不连接区域，且它们都步接触图像边界。
    即：$R_k, k = 1, 2, 3, ..., K$
    - 前景：定义为$R_n = R_1 \bigcup R_2 \bigcup ... \bigcup R_K$
    - 背景：定义为$(R_u)^c = S - R_u$
    - 内边界：一个区域的边缘或轮廓线。
    - 外边界：对应于背景边界

    - <font color='red'>一个区域和其背景中的点之间的邻接要根据8连通来定义！！！</font>

#### 2.5.3 距离度量

1. 距离函数或度量满足的条件
    - 正定性
    - 对称性
    - 距离三角不等式

2. 欧几里得距离
    - 计算公式：$D_e(p, q) = \sqrt{[(x - s)^2 + (y - t)^2]}$
    - 距像素点(x, y)的距离小于等于r的像素，一定在中心为(x, y)且半径为r的圆平面上。

3. 城市街区距离
    - 计算公式：$D_4(p, q) = |x - s| + |y - t|$
    - 所有距像素点(x, y)的距离小于等于r的像素，形成一个中心为(x, y)的菱形

4. 棋盘距离
    - 计算公式：$D_8(p, q) = max(|x - s|, |y - t|)$
    - 所有距像素点(x, y)的距离小于等于r的像素，形成一个中心为(x, y)的方形。

5. Dm距离
    用点间最短的通路定义。欧式距离、城市街区距离、棋盘距离都与通路无关。

### 2.6 数字图像处理所用数学操作

#### 2.6.1 数组和矩阵操作

##### 数组操作

1. 包含一幅或多幅图像的阵列操作是以逐像素为基础执行的
2. 数组对应元素的乘积
$
\left( 
\begin{array}{cc} 
a_{11} & a_{12} \\
a_21 & a_22 \end{array} 
\right)
$ $
\left( 
\begin{array}{cc} 
b_{11} & b_{12} \\
b_{21} & b_{22} \end{array} 
\right)
$ = $
\left( 
\begin{array}{cc} 
a_{11}b_{11} & a_{12}b_{12} \\
a_{21}b_{21} & a_{22}b_{22} \end{array} 
\right)
$

##### 矩阵操作
1. 把图像看作矩阵
2. 两幅图像的矩阵乘积为： 
$
\left( 
\begin{array}{cc} 
a_{11} & a_{12} \\
a_{21} & a_{22} \end{array} 
\right)
$ $
\left( 
\begin{array}{cc} 
b_{11} & b_{12} \\
b_{21} & b_{22} \end{array} 
\right)
$ = $
\left( 
\begin{array}{cc} 
a_{11}b_{11} + a_{12}b_{21} & a_{12}b_{12} + a_{12}b_{22} \\
a_{21}b_{11} + a_{22}b_{21} & a_{21}b_{12} + a_{22}b_{22} \end{array} 
\right)
$

#### 2.6.2 线性操作与非线性操作

1. 线性操作
    - 定义一个对图像的操作，对于给定输入图像f(x, y)，产生一幅输出图像g(x, y): $H[f(x, y)] = g(x, y)$ 该操作符H称为算子。
    - 几种特性
        - 奇次性：输入乘以常数的输出 = 输出执行操作的输出再乘以常数
        - 相加性：对两个输入的和进行操作 = 分别对两个输入进行操作然后再求和。
    - 表达: $H[a_if_i(x, y) + a_jf_j(x,y) = a_iH[f_i(x, y)] + a_jH[f_j(x, y)] = a_ig_i(x, y) + a_jg_j(x, y)$

2. 非线性操作
    不满足以上条件的操作。例如：取最大值。

#### 2.6.3 算术操作

> 图像间的算术操作是数组操作，算术操作再图像相应的像素对之间执行。

1. 利用加权平均去噪
    - 假设一张包含噪声的图像为: $g(x, y) = f(x, y) + \eta(x, y)$，其中$\eta(x, y)$是平均值为0的不相关的噪音函数, $f(x, y)$是无噪声的原始图像。
    - 可以通过一组带噪音的图像{$g_i(x, y)$}的相加来减少噪声。
        > 去噪原理：
            - $\overline{g}(x, y) = \frac1{M}\sum_{i=1}^{M}{g_i(x, y)}$
            - E{$\overline{g}(x, y)$} = $f(x, y)$
            - $\sigma^2_{\overline{g}(x, y)} = \frac1{M}\sigma^2_{\overline{\eta}(x, y)}$
            - 随着图像增多，原图与均值图像的差值图像和直方图均值减小，标准差减小，这意味着二者差别减小，图像变暗

2. 利用减法发现变化
3. 利用乘法修正阴影效果
4. 利用乘法做蒙版变换

#### 2.6.4 集合和逻辑操作

1. 集合操作
2. 逻辑运算：用来处理二值图像，把图像看作前景(1)和背景(0)。
    - 非运算：$g(x, y) = -f(x, y)$，也就是求补集操作
    - 与运算：求两个图像的相交子图
    - 或运算：合并子图像
    - 异或运算：获得相交子图像

#### 2.6.5 空间操作

1. 空间操作直接再给定图像的像素上执行。可以分为三大类：
    - 单像素操作
    - 邻域操作
    - 几何空间操作

2. 单像素操作
    - 图像取反

3. 邻域变换
    - 均值滤波: $g(x, y) = \frac1{mn}\sum_{(r, c) \in S_r}f(r, c)$

4. 几何空间变换
    - 仿射变换（其实就是坐标变换）
    - 可以根据矩阵中元素所选的值，对一组坐标点做尺度、旋转、平移或者偏移
    - 计算公式：$[x y 1] = [v w 1]T = [v w 1]\left(\begin{array}{cc}t_{11} & t_{12} & 0 \\t_{21} & t_{22} & 0\\t{31} & t_{32} & 1\end{array}\right)$


## 第三章 灰度变换和空间滤波

> 图像增强
    - 含义：突出图像中的某些信息，同时削弱或去除某些不需要信息，以得到视觉效果更“好”或更“有用”的图像的技术
    - 原因：在传输或处理过程中会引入噪声或使图像变模糊，从而降低了图像质量，甚至淹没了特征，给分析带来了困难
    - 目的：
        - 改善图像的视觉效果，提高图像的清晰度
        - 将图像转换成更适合于人眼观察和机器分析识别的形式，以便从图像中获取更有用的信息
    - 基本方法：
        - 空间域处理：包括点处理（图像灰度变换、直方图均衡等）、邻域处理（线性、非线性平滑和锐化等）
        - 频域处理：高、低通滤波、同态滤波

### 3.1 背景知识

> 空间域图像增强可由下式定义：$g(x, y) = T[f(x, y)]$，其中f为输入图像，g为输出图像，T是对f的一种操作，定义在(x, y)的邻域上

#### 3.1.1 空间滤波

步骤：
    - 找到邻域
    - 滑动窗口
    - 应用于邻域中的像素，并产生中心位置的输出g
    - 邻域和预定义的操作一起称为<font color='blue'>空间滤波器</font>

#### 3.1.2 灰度变换

针对单个像素，输出仅取决于点(x, y)的f值，T则称为灰度变换函数: $s = T(r)$。其中变量r和s分别表示输入图像f和输出图像g在点(x, y)处的灰度

### 3.2 点运算——基本的灰度变换函数

1. 图像反转

    - 灰度级范围[0, L-1]
    - 操作公式：$s = L - 1 - r$
    - 作用：黑的变白，白的变黑

2. 对数变换

    - 通用形式: $s = c\log(1+r)$
    - c是常数
    - 有时原图的动态范围太大，超出某些显示设备的允许动态范围，如直接使用原图，则一部分细节可能丢失。

3. 幂律变换(Gamma 变换)

    - 通用形式: $s = cr^\gamma$
    - 其中c和$\gamma$为正常数
    - $\gamma < 1$提高灰度级，使图像变亮；$gamma > 1$降低灰度级，使图像变暗
    - 应用：
        - 显示器的gamma校正
        - 观点传感器的输入输出特性

4. 对比拉伸变换

5. 分段线性变换函数
    - 优点：可以任意复杂
    - 对比度拉伸
    - 灰度级分层
    - 比特平面分层：把数字图像分解为位平面，（每一个位平面可以处理为一幅二值图像）对于分析每一位在图像中的相对重要性是有用的。

### 3.3 直方图处理

> 直方图是多种空间域处理的基础，直方图操作可用于图像增强、图像压缩和分割等。分为：
    - 直方图均衡
    - 直方图匹配（规定化）
    - 局部直方图处理

#### 3.3.1 直方图定义

1. 直方图
    - 一个灰度级在范围[0, L-1]的数字图像的直方图是一个离散函数: <font color = 'red'>$h(r_k) = n_k$</font>
    - $n_k$是图像中灰度级为$r_k$的像素个数, $r_k$是第k个灰度级, $k = 0, 1, 2, ..., L-1$ 
    - 由于$r_k$的增量是1， 直方图可表示为: <font color='red'>$p(k) = n_k$</font>，即图像中不同灰度级像素出现的次数。

2. 直方图的归一化
    - 一个灰度级在范围[0, L-1]的数字图像的直方图是一个离散函数: <font color='red'>$p(r_k) = n_k/n$</font>
    - n是图像的像素个数
    - $n_k$是图像中灰度级为$r_k$的像素个数
    - $r_k$是第k个灰度级，$k = 0, 1, 2, ..., L-1$
    - $p_r(r_k)$为原始图像灰度分布的概率密度函数
    - 吐过将r_k归一化到[0, 1]之间，则$r_k$可以看作区间[0, 1]的随机变量

3. 直方图和图像清晰度的关系
    直方图反映了图像的清晰程度，<font color='blue'>当直方图均匀分布时，图像最清晰</font>。因此可利用直方图来达到使图像清晰的目的。

#### 3.3.2 直方图均衡

1. 概述
    - 希望一幅图像的像素占有全部可能的灰度级且分布均匀，能够具有高对比度。
    - 使用的方法为灰度级变换: <font color='red'>$s = T(r)$</font>
    - 基本思想是把原始图的直方图变换为均匀分布的形式，这样就增加了像素灰度值的动态范围，从而达到增强图像整体对比度的效果。

2. 直方图均衡化处理
    - 假设原图的灰度值变量为r，变换后新图的灰度值变量为s，我们希望寻找一个灰度变换函数T: <font color='red'>$s = T(r)$</font>，使得概率密度函数$p_r(r)$变换成均匀分布的概率密度函数$p_s(s)$。

    - 灰度变换函数$T(r)$应该满足:
        - T(r)在区间 0 =< r <= 1 单值且单调递增
        - 当0 <= r <= 1时, 0 <= T(r) <= 1
        
    - 条件1保证原图各灰度级在变换后仍保持从黑到白（或从白到黑）的排列次序

    - 条件2保证变换前后灰度值的动态范围的一致性

    - $p_r(r)$是r的概率密度函数，$p_s(s)$是s的概率密度函数，$p_r(r)$和$T(r)$一直，且$T^{-1}(s)$满足上述条件(1)，所以
        $$
        P_s(s) = P_r(r)|\frac{dr}{ds}|
        $$
        

    - 直方图均衡化的灰度变换函数定义为:
      $$
      s = T(r) = (L - 1)\int_0^rp_r(w)dw
      $$
      可知关于上限的定积分的导数就是该上限的积分值（莱布尼茨准则）
      $$
      \frac{ds}{dr} = \frac{dT(r)}{dr} = \frac{d}{dr}[\int_0^rp_r(r)|\frac1{p_r(r)}|] = 1
      $$
      满足均匀分布条件

3. 离散图像的直方图均衡处理

    - 对于一幅数字图像的（离散）某一灰度级出现的概率近似为: 
        $$ 
        p_r(r_k) = \frac{n_k}{MN}, k = 0, 1, 2, ..., L - 1
        $$
    - 直方图均衡化的灰度变换函数的离散形式为：
        $$
        s_k = T(r_k) = (L - 1) \sum_{j=0}^kp_r(r_j) = \frac{L-1}{MN}\sum_{j=0}{k}n_j, k = 0, 1, 2, ..., L - 1
        $$

4. 说明

    - 直方图是近似的概率密度函数，所以用离散灰度级进行变换时很少得到完全平坦的结果
    - 变换后灰度级减少，出现灰度“简并”现象，造成一定灰度层次的损失
    - 该变换不可逆，不同图像的直方图可能均衡成为相同的直方图。

#### 3.3.3 直方图匹配

>   - 对于某些应用，采用均匀直方图的基本增强并不是最好的办法，有时我们需要处理后的图像具有规定的直方图形状
    - 我们希望通过一个指定函数（如高斯函数）产生一个特定的直方图。根据这个直方图确定一个灰度级变换T(r)，使由T产生的新图像的直方图符合指定的直方图。
    - 这种用于产生处理后有特殊直方图的方法称为直方图匹配或者直方图规定化。并不需要满足均匀分布的条件。

1. 算法思路

    已知：$p_r(r)$，$p_z(z)$分别为原图的概率密度函数和希望得到的概率密度函数。
    - 分别对$p_r(r)， p_z(z)$做直方图均衡化处理得到：
        $s = T(r) = (L - 1) \int_0^r p_r(w) dw$             <font color='red'>公式(3.3-10)</font>

        $G(z) = (L - 1) \int_0^z p_z(t)dt = s$              <font color='red'>公式(3.3-11)</font>
    - 由上面两个等式可以得到$G(z) = T(r)$，因此z满足下列条件:
    $$
    z = G^{-1}[T(r)] = G^{-1}(s)
    $$
    - 因此可以得到r -> s的映射，s -> z的映射，进而实现了r -> z的映射。

2. 直方图匹配过程

    - 由输入图像得到$p_r(r)$，并由式(3.3-10)求得s的值
    - 使用式(3.3-11)中指定的概率密度函数求得变换函数G(z)
    - 求得反变换函数$z = G^{-1}(s)$；因为z是由s得到的，所以该处理是s到z的映射，而后者正是我们期望的值。
    - 首先用式(3.3-10)对输入图像进行均衡得到输出图像；该像素的像素值是s值。对均衡后的图像中具有s值的每个像素执行反映射$z = G^{-1}(s)$，得到输出图像中的相应像素。当所有的像素都处理完后，输出图像的概率密度函数将等于指定的概率密度函数。

3. 离散图像的直方图匹配

    - 直方图均衡变换的离散形式为: $s_k = T(r_k) = (L - 1) \sum_{j=0}^k p_r(r_j) = \frac{L-1}{MN} \sum_{j=0}^k, k = 0, 1, 2, ..., L-1$
    - 式(3.3-11)的离散形式为: $G(z_q) = (L - 1) \sum_{i=0}^q p_z(z_i)$
    - 对于一个q值，有: G(z_q) = s_k
    - 用反变换找到期望值$z_q$： $z_q = G^{-1}(s_k)$

4. 离散图像的直方图均衡过程

    - 计算给定图像的直方图$p_r(r)$，并用它寻找直方图均衡变换。把$s_k$四舍五入为范围[0, L-1]内的整数
    - 对q = 0, 1, 2, ..., L-1计算变换函数G的所有值，其中$p_z(z_i)$是规定的直方图的值。把G的值四舍五入为范围[0, L-1]内的整数。将G的值存储在一个表中。
    - 对每一个值$s_k$， k = 0, 1, 2, ..., L-1，使用上一步存储的G值寻找相应的$z_q$值，以使$G(z_q)$最接近$s_k$，并存储这些从s到z的映射。当满足给定$s_k$的$z_q$值多于一个时（即映射不唯一）时，按惯例选择最小的值。
    - 首先对输入图像进行均衡，然后使用上一步中找到的映射把该图像的每个均衡后的像素值$s_k$映射为直方图规定化后的图像中的相应的$z_q$值，形成直方图规定化后的图像。正如连续情况那样，均衡输入图像的中间步骤是概念上的。它可以用合并两个变换函数$T$和$G^{-1}$跳过这一步。

#### 3.3.4 局部直方图处理

> 有时需要对图像小区域细节的局部增强。解决的方法就是在图像中每个像素的领域中，根据灰度级分布设计变换函数。然后利用前面介绍的思路进行局部增强。

- 灰度均值：对平均灰度的一种度量
- 灰度方差（标准差）：对平均对比度的一种度量。
- 实际中，在处理均值和方差时，通常用取样值来估计它们。

### 3.4 空间滤波基础

> 