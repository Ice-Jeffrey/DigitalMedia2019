# 数字图像处理课程报告

## 第一章 绪论

### 1.1 基本概念

1. 图像
    定义为二维函数f(x,y),其中，x,y是空间坐标，f(x,y)是点（x,y）的幅值，灰度图像是一个二维灰度（或亮度）函数f(x,y)，彩色图像由三个（如RGB,HSV）二维灰度（或亮度）函数f(x,y)组成

2. 模拟图像
    可用连续函数来描述，其光照位置和光照强度连续变化。

3. 数字图像
    - 空间坐标和灰度（亮度）均用离散的数字（一般是整数）。
    - 由像素组成的二维排列，可以用矩阵表示。
    - 对于单色（灰度）图像而言，每个像素的亮度通常用一个取值为0~255之间的数值来表示，0表示黑，355表示白，其他值表示处于黑白之间的灰度。
    - 彩色图像可以用红绿蓝三元组的二维矩阵来表示，通常每个数值也介于0~255之间，0表示响应基色在像素中没有，而255代表相应的基色在该像素中取得最大值。

4. 离散信号和数字信号的区别：模拟信号经过抽样变成离散信号，对离散信号进行进一步量化变为数字信号。

5. 像素
    具有特定位置(x, y)和幅度f(x, y)的构成数字图像的有限数量的元素。两个特点：位置和幅度。

6. 图像处理
    - 对图像信息进行加工分析和处理，以满足人的视觉心理需要和实际应用或某种目的（如压缩编码或机器识别的）的要求。
    - 数字图像处理：利用计算机对数字图像进行处理。
        - 优点：精度高、再现性好、方法易变、灵活度高。
        - 缺点：处理速度受到硬件限制。不过现在技术可以通过并行处理提高处理速度。
    - 图像处理的三个层次
        - 低级处理：对图像进行加工以改善图像效果，为图像分析做准备。（如图像去噪、图像增强、美颜ps等）。图像 -> 图像
        - 中级处理：对图像中感兴趣的目标进行检测和测量（特征提取），以获得客观的信息。（如提取颜色特征、直方图特征）。图像 -> 特征
        - 高级处理：研究图像中各目标的性质和其相互关系，理解图像的含义。（图像中两个人的关系、无人驾驶）。
    - 实例
        - 低级处理实例：
            - 水平翻转：f(x, y) = f(width - x, y)
            - 垂直翻转：f(x, y) = f(x, height - y)
            - 取反操作：f(x, y) = 255 - f(x, y)
            - 去噪处理：黑点椒噪声，白点盐噪声
            - 图像增强
        - 中级处理实例：
            - 图像分割
        - 高级处理实例：
            - 人脸检测

7. 图像处理机器相关领域

- 计算机视觉：使计算机来模仿人的视觉，包括理解并根据视觉输入采取行动。属于人工只能的一个分支。
- 图像理解：对图像的语义理解。

### 1.2 数字图像处理的起源与发展

- 最早应用：20世纪20年代，第一次通过海底电缆传输图像
- 诞生：20世纪60年代，第一台执行有意义的图像处理任务的大型计算机。
- 开始应用：20世纪60年代末、70年代初，开始用于医学图像、地球资源遥感监测和天文学等领域。
- 广泛应用：至今广泛用于工业、医学、生物科学、地理学、考古学、物理学、天文学等多个领域。
- 解决机器感知问题：
    - 自动字符识别
    - 军事识别
    - X射线和血样分类。

### 1.3 数字图像处理的应用实例
- Gamma射线成像
- X射线成像
- 紫外线成像
- 可见光及红外波段成像
    - 电磁波谱
    - 生产产品的自动视觉检测
    - 识别指纹、纸币、自动读取牌照
- 微波波段成像（雷达）
- 无线电波段成像（核磁共振）
- 其他成像方式
    - 声波图像
    - 超声波成像
    - 电子显微镜成像
    - 计算机合成成像

### 1.4 数字图像处理流程

> 图像获取 -> 图像增强 -> 图像复原 -> 彩色图像处理 -> 小波变换 -> 图像压缩 -> 形态学处理 -> 图像分割 -> 表示与描述 -> 目标识别

1. 图像增强（主观）：突出图像中主观感兴趣的部分，而减弱或去除不需要的信息，从而使有用的信息得到增强，便于区分或解释。

2. 图像恢复（客观）：去除干扰和模糊，恢复图像的本来面目。典型应用：去噪。

3. 图像分割：将图像中包含的物体，按其灰度或几何特性等划分为若干个有意义的区域。

4. 目标识别（以指纹识别为例）：
    - 原始灰度图像
    - 预处理
        - 去噪，增强对比度
    - 图像分割
        - 二值化
        - 细化
    - 特征提取
        - 把数据转换成适合计算机处理以及后续目标识别的形式
    - 进行识别
        - 使用匹配算法

### 1.5 数字图像处理系统组成
- 图像输入
- 图像存储
- 图像通信
- 图像处理和分析
- 图像输出

## 第二章 数字图像基础

### 2.1 视觉感知要素之亮度适应和鉴别

 >人眼对不同亮度和的适应和鉴别能力
    - 亮 -> 暗： 适应快
    - 暗 -> 亮： 适应慢

1. 视觉适应性

- 亮度适应级
    - 是视觉系统当前的灵敏度级别
    - 指的是人眼适应了某一环境后，该环境的平均亮度
- 亮度适应现象
    - 人眼并不能同时在整个范围内工作，而是利用改变灵敏度来实现大的动态范围内的变动
- 主观亮度
    进入人眼的光强度的对数函数

2. 辨别光强度的能力

3. 人眼感觉的亮度
    - 人眼对亮度的对比度敏感，而非对亮度本身敏感
    - 人眼主观感觉的亮度不是简单的取决于光强度。
        - 韦伯-费涅赫尔定理：亮度感觉S与实际亮度B的对比度的对数成线性关系。<font color = 'red'>$ S = k * \ln B + k_0 $</font>
            - 因此，重现景物的亮度范围无需与实际景物的亮度范围相同，只需保持二者的对比度相同。
            - 人眼不能辨别的亮度差别也无需重现出来，只需保持二者的亮度差别级数相同即可。

    - 马赫带效应
        - 一个物体和它周围的亮度的交互作用，产生一种马赫带效应.
        - 视觉系统有趋于过高或过低估计不同亮度区域边界值的效应，这就称为马赫带效应。
        - 虽然边缘亮度恒定，但感觉亮的地方更亮，暗的地方更暗。
    - 同时对比效应
      
        - 人眼对某个区域感觉的亮度（主观亮度）不仅依赖于自身亮度，还与其背景有关。例如一张纸白天看很亮，晚上看很黑。
    - 视觉错觉
      
        - 在错觉中，眼睛填上了不存在的信息或错误地感知了物体的几何特点。

### 2.2 光和电磁波谱

1. 人从物体感受到的颜色由物体反射光决定
    - 若所有反射的可见光波长均衡，则物体显示白色
    - 有颜色的物体是因为物体吸收了其他波长的大部分能量，反射了某段波长范围的光
    - 没有颜色的光叫做单色光或消光，灰度级通常来描述单色光的强度。其范围从黑到灰，最后到白。
2. 彩色光源的三个基本属性
    - 发光强度：从光源流出能量的总量。单位：瓦特
    - 光通量：观察者从光源感受到的能量。单位：流明
    - 亮度：光感受的主观描绘子。（不测能量）

### 2.3 图像的感知和获取

- 图像形成模型：
    - 在特定坐标处，通过传感器转换获得的f值为一正的标量。
    
    - 函数由<font color = "red">入射到观察场景的光源总量</font>和<font color="red">场景中物体反射光的总量组成</font>。
        $ f(x, y) = i(x, y) * r(x, y)  $
      其中f(x, y)介于0到正无穷之间，代表灰度。
      i(x, y)为<font color="blue">入射分量</font>，为白光强度。
      r(x, y)为<font color="blue">反射分量</font>，为平均反射系数。该系数为0时代表全吸收，系数为1时代表全反射。

### 2.4 图像的取样和量化

#### 2.4.1 取样和量化

1. 取样：图像空间坐标的数字化
2. 量化：图像函数值（灰度值）的数字化
    - 黑白图像：只有两个像素值0和1
    - 灰度图像：像素强度[0, 255]区间内
    - 彩色图像：在灰色图像的基础上，有了(R, G, B)三个通道。
3. 种类
    - 均匀采样和量化：等间隔
    - 非均匀采样和量化：灰度级变化尖锐的区域，进行细腻采样，灰度级平滑的区域，用粗糙的采样。
        - 在边界附近使用较少的灰度级
        - 避免画减少由于量化过于粗糙，在灰度级变化交平滑的区域出现假轮廓现象。

#### 2.4.2 数字图像的表示

1. 二维离散亮度函数f(x, y)
    - x, y为图像像素的空间坐标
    - 函数值f(x, y)代表了在点(x, y)处像素的灰度值
2. 二维矩阵A[m, n]
    - m, n代表图像的宽和高
    - 矩阵元素a(i, j)的值，表示图像在第i行，第j列的像素的灰度值；i, j表示几何位置。
3. 三种坐标系
    - 直角坐标系
    - 矩阵坐标系
    - 图像坐标系
4. 存储图像所需比特数: $ b = m * n * k $
   
    - 其中m, n为图像的尺寸
    - k位图像的位数，一个图像有 $2^k$ 个灰度值。

#### 2.4.3 空间和灰度分辨率

1. 空间分辨率（对应采样）
    图像中可分辨的最小细节，主要由采样间隔值决定，采样间隔值玉箫，空间分辨率越高,图像越清晰。

2. 灰度分辨率（对应量化）
    灰度级别中可分辨的最小变化，通常也把灰度级L称为灰度分辨率。

3. 小结
    图像分辨率依赖于M, N和L
    - 保持M * N不变减少L会导致假轮廓
    - 保持L不变减少M * N则会导致棋盘效果
    - 图像质量一般随着M * N和L的增加而增加，但存储量增大。

#### 2.4.4 图像的缩小和放大

1. 图像的收缩：下采样
2. 图像放大
    - 创立新的像素位置
    - 给新像素赋灰度值
        - 最近邻域内插
        - 双线性内插

### 2.5 像素间的基本关系

#### 2.5.1 相邻像素

1. 4邻域
    - (x-1, y) (x+1, y) (x, y-1) (x, y+1)
    - 用$N_4$表示
2. D邻域
    - (x-1, y-1) (x-1, y+1) (x+1, y-1) (x+1, y+1)
    - 用$N_D$表示
3. 8邻域
    - 4邻域和D邻域结合
    - 用$N_8$表示
    - $N_8(p) = N_4(p) + N_D(p)$

#### 2.5.2 邻接性、连通性、区域和边界

###### 一、邻接性

1. 像素相邻：两个像素在位置上相邻，且取值相同或相近
2. 三种类型邻接性：
    - 4邻接
    - 8邻接
    - m邻接（混合邻接）：对于具有值V的像素p和q
3. 4邻接必8邻接，反之不一定成立
4. m邻接
    - 对于具有像素值V的像素p和q，如果
        - q在集合$N_4(p)$中，或q在$N_D(q)$中
        - 并且$N_4(p)$和$N_4(q)$的交集为空(没有值V的像素)
    - 则称这两个像素是m连通的
    - 意义：消除8连接的二义性

##### 二、连通性

1. 通路
    像素$p(x_0, y_0)$到像素$q(x_n, y_n)$的通路定义为特定的像素序列: $(x_0, y_0), (x_1, y_1), (x_2, y_2), ..., (x_n, y_n)$，
    其中$(x_i, y_i)$和$(x_{i-1}, y_{i-1})$对于(1=< i <= n)是邻接的。n是通路长度。若起点和终点为同一个点，则通路是闭合通路。

2. 连通性
    若S是图像的一个像素子集，$\forall p, q \in S$，如果存在一条由S中像素组成从p到q的通路，则称p在图像集S中与q连通，连通也分为4连通和8连通。
    - 连通分量: $\forall p \in S$，$S$中连通到p的像素点的集合。
    - 连通集：如果S中仅有一个连通分量，则S叫连通集

##### 三、区域和边界

1. 区域
    R是图像中的像素子集，若R是连通集，则称R是一个区域。

2. 邻接区域
    两个区域，如果合并为一个区域，则称这两个区域为邻接区域。
    <font color='red'>注：定义邻接区域时，必须知名灰度相似性准则V={}和邻接类型</font>

3. 区域的边界
    假设图像中由K个不连接区域，且它们都步接触图像边界。
    即：$R_k, k = 1, 2, 3, ..., K$
    - 前景：定义为$R_n = R_1 \bigcup R_2 \bigcup ... \bigcup R_K$
    - 背景：定义为$(R_u)^c = S - R_u$
    - 内边界：一个区域的边缘或轮廓线。
    - 外边界：对应于背景边界

    - <font color='red'>一个区域和其背景中的点之间的邻接要根据8连通来定义！！！</font>

#### 2.5.3 距离度量

1. 距离函数或度量满足的条件
    - 正定性
    - 对称性
    - 距离三角不等式

2. 欧几里得距离
    - 计算公式：$D_e(p, q) = \sqrt{[(x - s)^2 + (y - t)^2]}$
    - 距像素点(x, y)的距离小于等于r的像素，一定在中心为(x, y)且半径为r的圆平面上。

3. 城市街区距离
    - 计算公式：$D_4(p, q) = |x - s| + |y - t|$
    - 所有距像素点(x, y)的距离小于等于r的像素，形成一个中心为(x, y)的菱形

4. 棋盘距离
    - 计算公式：$D_8(p, q) = max(|x - s|, |y - t|)$
    - 所有距像素点(x, y)的距离小于等于r的像素，形成一个中心为(x, y)的方形。

5. Dm距离
    用点间最短的通路定义。欧式距离、城市街区距离、棋盘距离都与通路无关。

### 2.6 数字图像处理所用数学操作

#### 2.6.1 数组和矩阵操作

##### 数组操作

1. 包含一幅或多幅图像的阵列操作是以逐像素为基础执行的
2. 数组对应元素的乘积
$
\left( 
\begin{array}{cc} 
a_{11} & a_{12} \\
a_21 & a_22 \end{array} 
\right)
$ $
\left( 
\begin{array}{cc} 
b_{11} & b_{12} \\
b_{21} & b_{22} \end{array} 
\right)
$ = $
\left( 
\begin{array}{cc} 
a_{11}b_{11} & a_{12}b_{12} \\
a_{21}b_{21} & a_{22}b_{22} \end{array} 
\right)
$

##### 矩阵操作
1. 把图像看作矩阵
2. 两幅图像的矩阵乘积为： 
$
\left( 
\begin{array}{cc} 
a_{11} & a_{12} \\
a_{21} & a_{22} \end{array} 
\right)
$ $
\left( 
\begin{array}{cc} 
b_{11} & b_{12} \\
b_{21} & b_{22} \end{array} 
\right)
$ = $
\left( 
\begin{array}{cc} 
a_{11}b_{11} + a_{12}b_{21} & a_{12}b_{12} + a_{12}b_{22} \\
a_{21}b_{11} + a_{22}b_{21} & a_{21}b_{12} + a_{22}b_{22} \end{array} 
\right)
$

#### 2.6.2 线性操作与非线性操作

1. 线性操作
    - 定义一个对图像的操作，对于给定输入图像f(x, y)，产生一幅输出图像g(x, y): $H[f(x, y)] = g(x, y)$ 该操作符H称为算子。
    - 几种特性
        - 奇次性：输入乘以常数的输出 = 输出执行操作的输出再乘以常数
        - 相加性：对两个输入的和进行操作 = 分别对两个输入进行操作然后再求和。
    - 表达: $H[a_if_i(x, y) + a_jf_j(x,y) = a_iH[f_i(x, y)] + a_jH[f_j(x, y)] = a_ig_i(x, y) + a_jg_j(x, y)$

2. 非线性操作
    不满足以上条件的操作。例如：取最大值。

#### 2.6.3 算术操作

> 图像间的算术操作是数组操作，算术操作再图像相应的像素对之间执行。

1. 利用加权平均去噪
    - 假设一张包含噪声的图像为: $g(x, y) = f(x, y) + \eta(x, y)$，其中$\eta(x, y)$是平均值为0的不相关的噪音函数, $f(x, y)$是无噪声的原始图像。
    - 可以通过一组带噪音的图像{$g_i(x, y)$}的相加来减少噪声。
        > 去噪原理：
            - $\overline{g}(x, y) = \frac1{M}\sum_{i=1}^{M}{g_i(x, y)}$
            - E{$\overline{g}(x, y)$} = $f(x, y)$
            - $\sigma^2_{\overline{g}(x, y)} = \frac1{M}\sigma^2_{\overline{\eta}(x, y)}$
            - 随着图像增多，原图与均值图像的差值图像和直方图均值减小，标准差减小，这意味着二者差别减小，图像变暗

2. 利用减法发现变化
3. 利用乘法修正阴影效果
4. 利用乘法做蒙版变换

#### 2.6.4 集合和逻辑操作

1. 集合操作
2. 逻辑运算：用来处理二值图像，把图像看作前景(1)和背景(0)。
    - 非运算：$g(x, y) = -f(x, y)$，也就是求补集操作
    - 与运算：求两个图像的相交子图
    - 或运算：合并子图像
    - 异或运算：获得相交子图像

#### 2.6.5 空间操作

1. 空间操作直接再给定图像的像素上执行。可以分为三大类：
    - 单像素操作
    - 邻域操作
    - 几何空间操作

2. 单像素操作
    - 图像取反

3. 邻域变换
    - 均值滤波: $g(x, y) = \frac1{mn}\sum_{(r, c) \in S_r}f(r, c)$

4. 几何空间变换
    - 仿射变换（其实就是坐标变换）
    - 可以根据矩阵中元素所选的值，对一组坐标点做尺度、旋转、平移或者偏移
    - 计算公式：$[x y 1] = [v w 1]T = [v w 1]\left(\begin{array}{cc}t_{11} & t_{12} & 0 \\t_{21} & t_{22} & 0\\t{31} & t_{32} & 1\end{array}\right)$


## 第三章 灰度变换和空间滤波

> 图像增强
    - 含义：突出图像中的某些信息，同时削弱或去除某些不需要信息，以得到视觉效果更“好”或更“有用”的图像的技术
    - 原因：在传输或处理过程中会引入噪声或使图像变模糊，从而降低了图像质量，甚至淹没了特征，给分析带来了困难
    - 目的：
        - 改善图像的视觉效果，提高图像的清晰度
        - 将图像转换成更适合于人眼观察和机器分析识别的形式，以便从图像中获取更有用的信息
    - 基本方法：
        - 空间域处理：包括点处理（图像灰度变换、直方图均衡等）、邻域处理（线性、非线性平滑和锐化等）
        - 频域处理：高、低通滤波、同态滤波

### 3.1 背景知识

> 空间域图像增强可由下式定义：$g(x, y) = T[f(x, y)]$，其中f为输入图像，g为输出图像，T是对f的一种操作，定义在(x, y)的邻域上

#### 3.1.1 空间滤波

步骤：
    - 找到邻域
    - 滑动窗口
    - 应用于邻域中的像素，并产生中心位置的输出g
    - 邻域和预定义的操作一起称为<font color='blue'>空间滤波器</font>

#### 3.1.2 灰度变换

针对单个像素，输出仅取决于点(x, y)的f值，T则称为灰度变换函数: $s = T(r)$。其中变量r和s分别表示输入图像f和输出图像g在点(x, y)处的灰度

### 3.2 点运算——基本的灰度变换函数

1. 图像反转

    - 灰度级范围[0, L-1]
    - 操作公式：$s = L - 1 - r$
    - 作用：黑的变白，白的变黑

2. 对数变换

    - 通用形式: $s = c\log(1+r)$
    - c是常数
    - 有时原图的动态范围太大，超出某些显示设备的允许动态范围，如直接使用原图，则一部分细节可能丢失。

3. 幂律变换(Gamma 变换)

    - 通用形式: $s = cr^\gamma$
    - 其中c和$\gamma$为正常数
    - $\gamma < 1$提高灰度级，使图像变亮；$gamma > 1$降低灰度级，使图像变暗
    - 应用：
        - 显示器的gamma校正
        - 观点传感器的输入输出特性

4. 对比拉伸变换

5. 分段线性变换函数
    - 优点：可以任意复杂
    - 对比度拉伸
    - 灰度级分层
    - 比特平面分层：把数字图像分解为位平面，（每一个位平面可以处理为一幅二值图像）对于分析每一位在图像中的相对重要性是有用的。

### 3.3 直方图处理

> 直方图是多种空间域处理的基础，直方图操作可用于图像增强、图像压缩和分割等。分为：
    - 直方图均衡
    - 直方图匹配（规定化）
    - 局部直方图处理

#### 3.3.1 直方图定义

1. 直方图
    - 一个灰度级在范围[0, L-1]的数字图像的直方图是一个离散函数: <font color = 'red'>$h(r_k) = n_k$</font>
    - $n_k$是图像中灰度级为$r_k$的像素个数, $r_k$是第k个灰度级, $k = 0, 1, 2, ..., L-1$ 
    - 由于$r_k$的增量是1， 直方图可表示为: <font color='red'>$p(k) = n_k$</font>，即图像中不同灰度级像素出现的次数。

2. 直方图的归一化
    - 一个灰度级在范围[0, L-1]的数字图像的直方图是一个离散函数: <font color='red'>$p(r_k) = n_k/n$</font>
    - n是图像的像素个数
    - $n_k$是图像中灰度级为$r_k$的像素个数
    - $r_k$是第k个灰度级，$k = 0, 1, 2, ..., L-1$
    - $p_r(r_k)$为原始图像灰度分布的概率密度函数
    - 吐过将r_k归一化到[0, 1]之间，则$r_k$可以看作区间[0, 1]的随机变量

3. 直方图和图像清晰度的关系
    直方图反映了图像的清晰程度，<font color='blue'>当直方图均匀分布时，图像最清晰</font>。因此可利用直方图来达到使图像清晰的目的。

#### 3.3.2 直方图均衡

1. 概述
    - 希望一幅图像的像素占有全部可能的灰度级且分布均匀，能够具有高对比度。
    - 使用的方法为灰度级变换: <font color='red'>$s = T(r)$</font>
    - 基本思想是把原始图的直方图变换为均匀分布的形式，这样就增加了像素灰度值的动态范围，从而达到增强图像整体对比度的效果。

2. 直方图均衡化处理
    - 假设原图的灰度值变量为r，变换后新图的灰度值变量为s，我们希望寻找一个灰度变换函数T: <font color='red'>$s = T(r)$</font>，使得概率密度函数$p_r(r)$变换成均匀分布的概率密度函数$p_s(s)$。

    - 灰度变换函数$T(r)$应该满足:
        - T(r)在区间 0 =< r <= 1 单值且单调递增
        - 当0 <= r <= 1时, 0 <= T(r) <= 1
        
    - 条件1保证原图各灰度级在变换后仍保持从黑到白（或从白到黑）的排列次序

    - 条件2保证变换前后灰度值的动态范围的一致性

    - $p_r(r)$是r的概率密度函数，$p_s(s)$是s的概率密度函数，$p_r(r)$和$T(r)$一直，且$T^{-1}(s)$满足上述条件(1)，所以
        $$
        P_s(s) = P_r(r)|\frac{dr}{ds}|
        $$
        
- 直方图均衡化的灰度变换函数定义为:
      $$
      s = T(r) = (L - 1)\int_0^rp_r(w)dw
      $$
      可知关于上限的定积分的导数就是该上限的积分值（莱布尼茨准则）
      $$
      \frac{ds}{dr} = \frac{dT(r)}{dr} = \frac{d}{dr}[\int_0^rp_r(r)|\frac1{p_r(r)}|] = 1
      $$
      满足均匀分布条件
  
3. 离散图像的直方图均衡处理

    - 对于一幅数字图像的（离散）某一灰度级出现的概率近似为: 
        $$
        p_r(r_k) = \frac{n_k}{MN}, k = 0, 1, 2, ..., L - 1
        $$
    - 直方图均衡化的灰度变换函数的离散形式为：
        $$
        s_k = T(r_k) = (L - 1) \sum_{j=0}^kp_r(r_j) = \frac{L-1}{MN}\sum_{j=0}{k}n_j, k = 0, 1, 2, ..., L - 1
        $$

4. 说明

    - 直方图是近似的概率密度函数，所以用离散灰度级进行变换时很少得到完全平坦的结果
    - 变换后灰度级减少，出现灰度“简并”现象，造成一定灰度层次的损失
    - 该变换不可逆，不同图像的直方图可能均衡成为相同的直方图。

#### 3.3.3 直方图匹配

>   - 对于某些应用，采用均匀直方图的基本增强并不是最好的办法，有时我们需要处理后的图像具有规定的直方图形状
    - 我们希望通过一个指定函数（如高斯函数）产生一个特定的直方图。根据这个直方图确定一个灰度级变换T(r)，使由T产生的新图像的直方图符合指定的直方图。
    - 这种用于产生处理后有特殊直方图的方法称为直方图匹配或者直方图规定化。并不需要满足均匀分布的条件。

1. 算法思路

    已知：$p_r(r)$，$p_z(z)$分别为原图的概率密度函数和希望得到的概率密度函数。
    - 分别对$p_r(r)， p_z(z)$做直方图均衡化处理得到：
        $s = T(r) = (L - 1) \int_0^r p_r(w) dw$             <font color='red'>公式(3.3-10)</font>

        $G(z) = (L - 1) \int_0^z p_z(t)dt = s$              <font color='red'>公式(3.3-11)</font>
    - 由上面两个等式可以得到$G(z) = T(r)$，因此z满足下列条件:
    $$
    z = G^{-1}[T(r)] = G^{-1}(s)
    $$
    - 因此可以得到r -> s的映射，s -> z的映射，进而实现了r -> z的映射。

2. 直方图匹配过程

    - 由输入图像得到$p_r(r)$，并由式(3.3-10)求得s的值
    - 使用式(3.3-11)中指定的概率密度函数求得变换函数G(z)
    - 求得反变换函数$z = G^{-1}(s)$；因为z是由s得到的，所以该处理是s到z的映射，而后者正是我们期望的值。
    - 首先用式(3.3-10)对输入图像进行均衡得到输出图像；该像素的像素值是s值。对均衡后的图像中具有s值的每个像素执行反映射$z = G^{-1}(s)$，得到输出图像中的相应像素。当所有的像素都处理完后，输出图像的概率密度函数将等于指定的概率密度函数。

3. 离散图像的直方图匹配

    - 直方图均衡变换的离散形式为: $s_k = T(r_k) = (L - 1) \sum_{j=0}^k p_r(r_j) = \frac{L-1}{MN} \sum_{j=0}^k, k = 0, 1, 2, ..., L-1$
    - 式(3.3-11)的离散形式为: $G(z_q) = (L - 1) \sum_{i=0}^q p_z(z_i)$
    - 对于一个q值，有: G(z_q) = s_k
    - 用反变换找到期望值$z_q$： $z_q = G^{-1}(s_k)$

4. 离散图像的直方图均衡过程

    - 计算给定图像的直方图$p_r(r)$，并用它寻找直方图均衡变换。把$s_k$四舍五入为范围[0, L-1]内的整数
    - 对q = 0, 1, 2, ..., L-1计算变换函数G的所有值，其中$p_z(z_i)$是规定的直方图的值。把G的值四舍五入为范围[0, L-1]内的整数。将G的值存储在一个表中。
    - 对每一个值$s_k$， k = 0, 1, 2, ..., L-1，使用上一步存储的G值寻找相应的$z_q$值，以使$G(z_q)$最接近$s_k$，并存储这些从s到z的映射。当满足给定$s_k$的$z_q$值多于一个时（即映射不唯一）时，按惯例选择最小的值。
    - 首先对输入图像进行均衡，然后使用上一步中找到的映射把该图像的每个均衡后的像素值$s_k$映射为直方图规定化后的图像中的相应的$z_q$值，形成直方图规定化后的图像。正如连续情况那样，均衡输入图像的中间步骤是概念上的。它可以用合并两个变换函数$T$和$G^{-1}$跳过这一步。

#### 3.3.4 局部直方图处理

> 有时需要对图像小区域细节的局部增强。解决的方法就是在图像中每个像素的领域中，根据灰度级分布设计变换函数。然后利用前面介绍的思路进行局部增强。

- 灰度均值：对平均灰度的一种度量
- 灰度方差（标准差）：对平均对比度的一种度量。
- 实际中，在处理均值和方差时，通常用取样值来估计它们。

### 3.4 空间滤波基础

> 空间滤波：使用空间模板进行的图像处理。模板本身被称为空间滤波器。

#### 3.4.1 空间滤波器

1. 构成：一个邻域以及对该邻域包围的图像像素执行的预定义操作。
2. 空间线性滤波的表示
    - 在M * N的图像f上，使用m * n的滤波器：
    $$
    g(x, y) = \sum_{s = -a}^a \sum_{t = -b}^b w(s, t)f(x+s, y+t) 
    $$
    ​	    其中m = 2a+1, n=2b+1, w(s, t)是滤波器系数, f(x, y)是图像值
3. 线性滤波的向量表示: $R = w_1z_1 + w_2z_2+...+w_{mn}z_{mn} = \sum_{k=1}^{mn}w_kz_k = w^Tz$

#### 3.4.2 相关与卷积

1. 一维情况
    - 相关: $r_{xy}[n] = \sum_{k=-\infty}^{\infty} x[k]y[k+n]$
    - 卷积: $x[n] * y[n] = \sum_{k=-\infty}^{\infty} x[k]y[k-n]$

2. 离散单位冲激函数: 是指包含单个1而其余都是0的函数
    - 任意一个函数和冲激函数的相关相当于复制冲激位置上此函数的反转“版本”
    - 任意一个函数和冲激函数的卷积相当于在该冲激处这个函数的拷贝。

3. 二维卷积和相关：进行向量相乘操作，类似于一维运算

#### 3.4.3 空间滤波器模板的产生

    - 线性滤波器：确定滤波器模板系数。如均值滤波、二维高斯函数
    - 非线性滤波器：确定邻域大小和所要执行的操作。

### 3.5 空间平滑滤波器

>   1. 用途：用于模糊处理和减少噪声
    2. 平滑空间滤波器的分类
        - 线性滤波器：均值滤波器
        - 非线性滤波器： 最大值、中值、最小值滤波器

#### 3.5.1 平滑线性滤波器

1. 包含滤波器邻域内像素的平均值，也称为均值滤波器
2. 作用：减小图像的尖锐变化，减小噪声；由于图像边缘是由图像灰度尖锐变化引起的，也存在边缘模糊的问题。
3. 加权均值滤波器： 
    $$
    g(x, y) = \frac{\sum_{s=-a}^a \sum_{t=-b}^b w(s,t)f(x+s, y+t)}{\sum_{s=-a}^a \sum_{t=-b}^bw(s,t)}
    $$
4. 高斯低通滤波器:
    - 计算公式（加权的均值滤波器）
        $$
        G(x, y) = exp(-\frac{x^2+y^2}{\sigma^2})
        $$
    - 特点：
        - 具有旋转对称性，在各个方向平滑程度相同
        - 每一邻域像素点权值岁点与中心点距离单调递减
        - 参数$\sigma$表征滤波器的频带宽度，$\sigma$越大，平滑程度越好，图像越模糊。  

#### 3.5.2 统计排序滤波器

1. 概念
    - 是一种非线性滤波器
    - 基于滤波器所在图像区域中像素的排序，由排序结果决定的值代替中心像素的值
2. 分类
    - 中值滤波器
        - 主要用途：去噪
        - 特点
            - 去噪同时较好保留边缘锐度和图像细节
            - 能够有效消除脉冲噪声；以黑白点叠加在图像上
            - 使用其来去除那些相对于邻域像素更亮或更暗并且其区域小于一半的孤立像素族。
    - 最大值滤波器
        - 主要用途：寻找最亮点
    - 最小值滤波器
        - 主要用途：寻找最暗点

### 3.6 锐化滤波器

#### 3.6.1 锐化滤波器
1. 主要用途：
    - 突出图像中的细节，增强被模糊的细节
    - 印刷中的细微层次强调。弥补扫描对图像的钝化
    - 超声探测成像，分辨率低，边缘模糊，通过锐化来改善
    - 图像识别中，分割前的边缘提取
    - 锐化处理恢复过毒钝化、曝光不足的图像
    - 尖端武器的目标识别、定位

2. 原理：均值产生钝化的效果，微分产生相反的锐化效果。

3. 锐化——空间微分
    - 一阶微分的基本定义是差值:
        $$
        \frac{\partial{f}}{\partial{x}} = f(x+1)-f(x)
        $$
    - 二阶微分定义为差分
        $$
        \frac{\partial^2f}{\partial{x^2}} = f(x+1)+f(x-1)-2f(x)
        $$
    - 一阶微分满足：
        - 在恒定灰度区域的微分值为0
        - 在灰度阶梯或斜坡的起点处微分值非零
        - 沿着斜坡的微分值非零
    - 二阶微分满足
        - 在恒定灰度区域微分值为0
        - 在灰度阶梯或斜坡的起点处微分值非零
        - 沿着胁迫面微分值为0

#### 3.6.2 拉普拉斯算子

- 二元图像函数f(x,y)的拉普拉斯变换定义为：
    $$
    \nabla^2f = \frac{\partial^2f}{\partial{x^2}} + \frac{\partial^2f}{\partial{y^2}}
    $$
    该变换满足最简单的各向同性，并且是一个线性操作
- 离散方式：
    $$
    \frac{\partial^2f}{\partial{x^2}} = f(x+1) + f(x-1) - 2f(x)
    $$
    $$
    \frac{\partial^2f}{\partial{y^2}} = f(y+1) + f(y-1) - 2f(y)
    $$
- 拉普拉斯数字实现由以上两个分量相加
    $$
    \nabla^2f = [f(x+1,y) + f(x-1,y) + f(x,y+1) + f(x,y-1)] - 4f(x, y)
    $$
- 拉普拉斯微分算子强调图像中灰度的突变，弱化灰度缓慢变化的区域。这将产生一幅把浅灰色边线、突变点叠加到暗背景中的图像
- 将原始图像和拉普拉斯图像叠加在一起的简单方法可以保持拉普拉斯锐化处理的效果，同时又能复原背景信息。因此拉普拉斯算子用于图像增强的基本方法如下:
    - 如果拉普拉斯掩模中心系数为负
        $$
        g(x,y) = f(x,y) - \nabla^2f(x,y)
        $$
    - 如果拉普拉斯掩模中心系数为正
        $$
        g(x,y) = f(x,y) + \nabla^2f(x,y)
        $$

#### 3.6.3 反锐化掩蔽与高频提升滤波

1. 反锐化掩模
    - 长期以来在出版业中使用的图像锐化是将图像模糊形式从原始图像中去除，称为反锐化掩蔽。反锐化掩蔽的基本算法如下:$g(x,y) = f(x, y) + k[f(x,y) - \overline{f}(x, y)]$
    - $f(x,y) - \overline{f}(x,y)$会使f(x,y)的低频成分损失很多，而高频部分较完整地被保留下来

2. 高频提升滤波（反锐化掩模的进一步普遍形式）
    - 定义：$f_{hb}(x,y) = Af(x, y) - \overline{f}(x,y)$
        即: $f_{hb}(x,y) = (A-1)f(x, y) + f(x,y) - \overline{f}(x,y) = (A-1)f(x,y) + f_s(x,y)$
    - A越大，锐化效果越不明显
    - 主要用途：输入图像太暗时，通过不同的提升系数，在锐化的同时，使图像的平均灰度增加

#### 3.6.4 使用一阶微分对图像锐化——梯度算子

- 梯度算子
    - 线性算子（向量）：$\nabla{f} = \left( \begin{array}{c} g_x \\ g_y \end{array} \right) = \left( \begin{array}{c} \frac{\partial{f}}{\partial{x}} \\ \frac{\partial{f}}{\partial{y}} \end{array} \right)$ 
    - 线性算子，满足各向同性
- 梯度（模值）
    - $M(x,y) = mag(\nabla{f}) = \sqrt{g_x^2 + g_y^2}$
- 实际运算时使用的数字梯度:
    - $M(x,y) = |g_x| + |g_y|$

- Robert交叉梯度算子
- Prewitt算子
- Sobel算子
    - 检测边缘
- 混合空间增强

## 第四章 频率域滤波

### 4.1 背景

1. 任何周期函数都可以表示为不同频率的正弦和或余弦和形式，甚至非周期函数也可以用正弦和或余弦乘以加权函数的积分来表示
2. 复数

### 4.2 周期信号的频谱分析——傅里叶级数

1. 三角形式的傅里叶级数
    - 计算公式：$f(t) = a_0 + \sum_{n=1}^{infty}(a_n\cos{n\omega_1t}+b_n\sin{n\omega_1t})$
    - 直流分量: $a_0 = \frac1{T_1}\int_{t_0}^{t_0+T_1}f(t)dt$
    - 余弦分量: $a_n = \frac2{T_1}\int_{t_0}^{t_0+T_1}f(t)\cos{n\omega_1t}dt$
    - 正弦分量: $a_n = \frac2{T_1}\int_{t_0}^{t_0+T_1}f(t)\sin{n\omega_1t}dt$
2. 指数形式的傅里叶级数
   
    - $f(t) = a_0 + \sum_{n=1}^{\infty}(a_n\cos{n\omega_1t}+b_n\sin{n\omega_1t})$
3. 周期矩形信号的傅里叶级数
   
    - $F_n = \frac{E\tau}{T_1}Sa(\frac{n\omega_1t}2)$
4. 傅里叶变换
    - 连续变量函数的傅里叶变换:
    $$
    \left\{ \begin{array}{rcl}
    F(u) = \int_{-\infty}^{\infty}f(t)e^{-2j\pi ut}dt = \int_{-\infty}^{\infty}f(t)e^{-j\omega t}dt
    \\
    F(t) = \int_{-\infty}^{\infty}F(u)e^{2j\pi ut}dt = \int_{-\infty}^{\infty}F(\omega)e^{j\omega t}d\omega
    \end{array}\right.
    $$
5. 傅里叶变换的基本性质
    - 线性：相加的傅里叶变换等于分别信号傅里叶变换的相加
    - 对称性：利用其对称性可把其逆变换转换为求傅里叶变换
    - 位移特性
    - 尺度变换特性
    - 微分与积分特性：时域微分特性和频率微分特性
6. 卷积定理
    - 时域中的卷积的傅里叶变换等于频率傅里叶变换的相乘
    - 时域中的相乘相当于频率域的卷积。
    - 卷积积分的代数性质
        - 交换律
        - 分配律
        - 结合律

### 4.3 二维离散傅里叶变换性质

#### 4.3.1 空间域抽样间隔和频域间隔之间的关系

- $\Delta{u} = \frac1{M\Delta{x}}$
- $\Delta{v} = \frac1{N\Delta{y}}$

#### 4.3.2 平移和旋转

- 用指数项乘以f(x,y)将使DFT的原点移到点(μ0,ν0)；
- 反之，用负指数项乘以F(μ,ν)将使f(x,y)的原点移到点(x0,y0)

#### 4.3.3 周期性
1. $F (u, v ) = F (u + M , v ) = F (u, v + N ) = F (u + M , v + N )$
    $f (x, y ) = f (x + M , y ) = f (x, y + N ) = f (x + M , y + N )$
2. 尽管F(u,v)对无穷多个u和v的值重复出现，但只需根据在任一个周期里的N个值就可以从F(u,v)得到f(x,y)
3. 只需一个周期里的变换就可将F(u,v)在频域里完全确定
4. 同样的结论对f(x,y)在空域也成立
5. $\ni[f(x)(-1)^x] = F(u - \frac{M}2)$
    说明：上式将F(u)的原点变换到(M/2)处。这样，在区间[0,M-1]内就包含了数据的一个完整周期。
6. F(u, v)的原点变换：$\ni[f(x)(-1)^{x+y}] = F(u - \frac{M}2, v - \frac{N}2)$
    说明：将F(u,v)的原点(0,0)变换到频率坐标下的(M/2，N/2)，它是M×N区域的中心（M、N为偶数）。这样，在区域[0,M1]([0,N-1])内就包含了数据的一个完整周期。

#### 4.3.4 对称性

1. 奇函数和偶函数
    - 两个偶函数或两个奇函数的积是偶函数
    - 一个偶函数和一个奇函数的积是奇函数
    - 离散奇函数所有样本之和为零
    
2. 偶函数的傅里叶变换是实函数，奇函数的傅里叶变换是虚函数

3. 实函数的傅里叶变换是共轭对称的，虚函数的傅里叶变换是共轭反对称的

4. | 空间域         | 频率域         |
    | -------------- | -------------- |
    | 实函数和偶函数 | 实函数和偶函数 |
    | 实函数和奇函数 | 虚函数和奇函数 |
    | 虚函数和偶函数 | 虚函数和偶函数 |
    | 虚函数和奇函数 | 实函数和奇函数 |
    | 复函数和偶函数 | 复函数和偶函数 |
    | 复函数和奇函数 | 复函数和奇函数 |

#### 4.6.5 傅里叶谱和相角

1. 二级傅里叶变换的极坐标表示：$F(u, v) = |F(u, v)|e^{j\Phi(u,v)} = R(u, v) + jI(u,v)$
2. 幅度谱或频率谱为: $|F(u, v)| = \sqrt{R^2(u,v) + I^2(u,v)}$
3. 相角或相位谱为: $\Phi(u,v) = \arctan{\frac{I(u,v)}{R(u,v)}}$
4. 功率谱为：$P(u,v) = |F(u,v)|^2 = R^2(u,v) + I^2(u,v)$
    - 实函数的傅里叶变换时共轭对称的
    - 因此幅度谱是关于原点偶对称的，相位谱是关于原点奇对称的
    - 零频率项（直流分量）与f(x,y)的平均值成正比
5. 幅度谱图像
    - 频谱图上我们看到的明暗不一的亮点，实际上图像上某一点灰度值与邻域点差异的强弱，即梯度的大小，也叫该点(u,v)的频率的大小
    - 从谱图像中可以看出
        - 图像的能量分布。如果频谱图中暗点多，那么实际图像是比较柔和的（因为各点与邻域灰度差异都不大，梯度相对较小），反之，如果频谱图中亮点多，那么实际图像一定是尖锐的，边界分明且边界两边像素差异较大的。
        - 图像的频谱分布。频谱移频到显示屏中心后，图像的频谱分布是以中心为圆心，对称分布的。
6. 二维卷积定理
    - 二维循环卷积: $f(x,y) \star h(x,y) = \sum_{m=0}^{M-1}\sum_{n=0}^{N-1}f(m,n)h(x-m,y-n)$
    - $f(x,y) \star h(x,y)$等价于$F(u,v)H(u,v)$
    - $f(x,y)h(x,y)$ 等价于 $F(u,v) \star H(u,v)$ 
    - 频域计算卷积的框图: $g_{PxQ}(x,y) = f_{AxB}(x,y) \star h_{CxD}(x,y)$

### 4.7 频域滤波基础

> 频域：频率变量(u,v)定义的空间。FT的频率分量(u,v)和图像空间特征（灰度变化模式）之间的联系。
    - 变化最慢的频率成分(u=v=0)对应一幅图像的平均灰度级
    - 当从变换的原点移开时，低频对应着图像的慢变化分量，如图像的平滑部分
    - 进一步离开原点时，较高的频率对应图像中变化越来越快的灰度级，如边缘或噪声等尖锐部分

#### 4.7.1 频率域滤波的基本步骤
    - 基本思想：通过滤波器函数以某种方式来修改图像变换，然后通过取结果的反变换来获得处理后的输出图像
    - 具体步骤
        - 预处理
        - 傅里叶变换
        - 滤波
        - 反傅里叶变换
        - 得到结果

#### 4.7.2 基本滤波器及其性质

1. 陷波滤波器
    - $$
        H(u, v) = 
        \left\{ \begin{array}{rcl}
        0 & \mbox{for} & (u,v) = (\frac{M}2, \frac{N}2) 
        \\
        1 & \mbox{for} & 其他
        \end{array}\right.
        $$
    - 设置F(0,0)=0(结果图像的平均值为零)，而保留其它傅里叶变换的频率成分不变
    - 除了原点处(0,0)有凹陷外，其它均是常量函数。由于图像平均值为0而产生整体平均灰度级的降低
    - 用于识别由特定的、局部化频域成分引起的空间图像效果

2. 低通滤波器和高通滤波器
    - 低通滤波器： 使低频通过，高频衰减的滤波器
        - 被低通滤波的图像比原始图像少了尖锐的细节部分而突出了平滑过渡部分
        - 类比空间域滤波的平滑处理，如均值滤波器
    - 高通滤波器：使高频通过而使低频衰减的滤波器
        - 被高通滤波的图像比原始图像少了灰度级的平滑过渡而突出了边缘等细节部分
        - 类比空间域的梯度算子、拉普拉斯算子

#### 4.7.3 频率域滤波的步骤

1. 对要滤波的图像$f_{MxN}(x,y)$进行填充得到$f_{PxQ}(x, y)$，典型地：P=2M,Q=2N
2. 用$(-1)^{x+y}$乘以输入图像进行中心变换
3. 变换到频域
4. 生成一个实的、中心对称的滤波器$H_{PxQ}(x,y)$，中心在$(\frac{P}{2}, \frac{Q}{2})$
5. 频域滤波:$G(u,v) = F(u,v)H(u,v)$
6. 变换到空间域
7. 取实部
8. 取消输入图像的乘数
9. 提取M*N区域

#### 4.7.4 空间域滤波和频率域滤波之间的对应关系

1. 大小为M×N的两个函数f(x,y)和h(x,y)的频率域滤波表示为：$H(u,v)*F(u,v)$.由卷积定理，该运算对应的空间域运算为：
    $f(x,y) \star h(x,y) = \sum_{m=0}^{M-1}\sum_{n=0}^{N-1}f(m,n)h(x-m,y-n)$
    对比空间域滤波：在MxN图像f上，用m*n的滤波器进行线性滤波
    $g(x,y) = \sum_{s=-a}^{a}\sum_{t=-b}^{b}w(s,t)f(x+s,y+t) $
    - 上式和下式本质上是相似的；在实践中，我们宁愿使用下式和较小的滤波器模板来实现滤波处理；
    - 滤波在频率域中更为直观，可以在频率域指定滤波器，做反变换，然后在空间域使用结果滤波器作为在空间域构建小滤波器模板的指导；

### 4.8 频率域平滑滤波

1. 频域低通滤波器：由于噪声主要集中在高频部分，为去除噪声改善图像质量，滤波器采用低通滤波器 来抑制高频成分，通过低频成分，然后再进行逆傅立叶变换获得滤波图像，就可达到平滑图像的目的
    - 理想低通滤波器
    - 巴特沃斯低通滤波器
    - 高斯低通滤波器

2. 
    - 边缘和噪声等尖锐变化处于傅里叶变换的高频部分
    - 平滑可以通过衰减高频成分的范围来实现
    - 理想低通滤波器：尖锐
    - 巴特沃思低通滤波器：处于理想和高斯滤波器之间
    - 高斯低通滤波器：平滑

3. 低通滤波器的应用
    - 字符识别：通过模糊图像，桥接断裂字符的裂缝
    - 印刷和出版业：从一幅尖锐的原始图像产生平滑、柔和的外观，如人脸，减少皮肤细纹的锐化程度和小斑点
    - 处理卫星和航空图像：尽可能模糊细节，而保留大的可识别特征。低通滤波通过消除不重要的特征来简化感兴趣特征的分析

4. 小结
    - 对于相同截止频率，GLPF与二阶BLPF相比，平滑效果要稍微差一些
    - GLPF没有振铃
    - 如果需要严格控制低频和高频之间截至频率的过渡，选用BLPF；其代价是可能产生振铃

### 4.9 频率域锐化

1. 由于图像的边缘、细节主要位于高频部分，而图像的模糊是由于高频成分比较弱产生的。频率域锐化就是为了消除模糊，突出边缘。因此采用高通滤波器让高频成分通过，使低频成分削弱，再经傅立叶逆变换得到边缘锐化的图像.

2. 几种频率域锐化滤波器
    - 理想高通滤波器
    - 巴特沃思高通滤波器
    - 高斯高通滤波器
    - 频率域的拉普拉斯算子
    - 钝化模板、高频提升滤波和高频加强滤波

3. 几种滤波器
    - 理想高通滤波器
    - 巴特沃斯高通滤波器
    - 高斯（指数）高通滤波器

4. 几种高通滤波器小结
    - 三种滤波函数的选用类似于低通。
    - 理想高通有明显振铃现象，即图像的边缘有抖动现象；
    - Butterworth高通滤波效果较好，但计算复杂，其优点是有少量低频通过，是渐变的，振铃现象不明显；
    - 指数高通效果比Butterworth差些，振铃现象不明显；
    - 一般来说，不管在图像空间域还是频率域，采用高频滤波不但会使有用的信息增强，同时也使噪声增强。因此不能随意地使用

5. 频率域的拉普拉斯算子: $\ni[\frac{d^n f(x)}{dx^n}] = (j2\pi u)^nF(u)$

6. 钝化模板、高频提升滤波和高频强调滤波
    - 为什么要进行高频提升和高频加强？  
        高频滤波后的图像，其背景平均强度减小到接近黑色（因为高通滤波器滤除了傅里叶变换的零频率成分:F(0,0)=0）
    - 解决办法：把原始图像加到过滤后的结果中，如拉普拉斯算子增强，这种处理称为高频提升滤波。它是钝化模板的推广。
    - 钝化模板(锐化或高通图像)：从一幅图像减去其自身模糊图像从而生成锐化图像。在频率域，即从图像本身减去低通滤波（模糊）后的图像而得到高通滤波（锐化）的图像。
    - 钝化模板和高频提升过滤：当k=1,即钝化模板；当k>1,高提升滤波

## 第五章 图像复原

### 5.1 概述

1. 退化: 成像过程中的”退化”，是指由于成像系统各种因素的影响，使得图像质量降低

2. 产生退化的原因
    - 引起图像退化的原因
    - 成像系统的散焦
    - 成像设备与物体的相对运动
    - 成像器材的固有缺陷
    - 外部干扰等
    
3. 图像增强和图像复原的对比

    |              | 图像增强                                                     | 图像复原                                                     |
    | ------------ | ------------------------------------------------------------ | ------------------------------------------------------------ |
    | **主要目的** | 提高图像的可懂度                                             | 提高图像的逼真度                                             |
    | **方法**     | <font color='red'>空间域法和频率域法</font>。空间域法主要是对图像的灰度进行处理；频率域法主要是滤波。 | 重点介绍线性复原方法                                         |
    | **技术特点** | <font color='red'>不考虑图像降质的原因</font>，只将图像中感兴趣的特征有选择地突出（增强），而衰减其不需要的特征；改善后的图像<font color='red'>不一定</font>要去接近原图像；是一个主观过程。 | 要考虑图像降质的原因，建立“降质模型”；要建立客观评价复原好坏的客观标准；是一个客观的过程。 |

4. 图像增强和图像复原的差别
    - 图像增强不考虑图像是如何退化的，而是试图采用各种技术来增强图像的视觉效果。因此，图像增强可以不顾增强后的图像是否失真，只要看得舒服就行。
    - 而图像复原就完全不同，需知道图像退化的机制和过程先验知识，据此找出一种相应的逆处理方法，从而得到复原的图像。

5. 图像复原与增强
    - 二者（图像复原与增强）的目的都是为了改善图像的质量。
    - 如果图像已退化，应先作复原处理，再作增强处理。

### 5.2 图像复原

1. 图像复原:是在研究图像的退化原因基础上，以退化图像为依据，根据一定的先验知识，建立一个退化模型然后用相反的运算，以恢复原始景物图像。
2. 步骤：找退化原因 → 建立退化模型 → 反向推演 → 恢复图像

### 5.3 有噪声图像复原

1. 噪声模型：数字图像中的噪声主要来源于图像的获取和传输过程
    - 图像获取的数字化过程，如图像传感器的质量和环境条件
    - 图像传输过程中传输信道的噪声干扰，如通过无线网络传输的图像会受到光线干扰或其他大气因素的干扰。

2. 一些重要的噪声
    - 高斯噪声
    - 瑞利噪声
    - 伽马（爱尔兰）噪声
    - 指数分布噪声
    - 均匀分布噪声
    - 脉冲噪声（椒盐噪声）

3. 高斯噪声
    - 概率密度函数: $p(z) = \frac1{\sqrt(2\pi \sigma)} e^{\frac{-(z-\mu)^2}{2\sigma^2}}$
    - 区间特性
    - 高斯噪声的产生源于电子电路噪声和由低照明度或高温带来的传感器噪声。高斯噪声数学上易于处理，实践中经常使用。

4. 瑞利噪声
    - 概率密度函数
    - 距离原地的位移是a
    - 函数曲线向右变形

5. Gamma噪声

6. 指数分布
    - pdf是当b=1时，gamma噪声的特殊情况

7. 均匀分布噪声

8. 脉冲噪声
    - 可以为正，可以为负
    - 标定以后，总是数字化为最大值（纯黑或纯白）
    - 通常，负脉冲以黑点（胡椒点）出现，正脉冲以白点（盐点）出现

9. 几种噪声的应用
    - 高斯噪声源于电子电路噪声和由低照明度或高温带来的传感器噪声
    - 瑞利噪声对分布在图像范围内特征化噪声有用
    - 伽马分布和指数分布用于激光成像噪声
    - 均匀密度分布作为模拟随机数产生器的基础
    - 脉冲噪声用于成像中的短暂停留中，如错误的开关操作

10. 噪声及其直方图
    - 上述噪声图像的直方图和它们的概率密度函数曲线对应相似
    - 前面5种噪声的图像并没有显著不同
    - 但它们的直方图具有明显的区别

### 5.4 仅有噪声图像复原

#### 5.4.1 概述
1. 空间域滤波复原（唯一退化是噪声）当唯一退化是噪声时，
    $g(x,y) = f(x,y) + \eta(x,y)$
    $G(u,v) = F(u,v) + N(u,v)$
    - 噪声项未知，不能从g(x,y)或G(u,v)减去噪声
    - 可以选择空间滤波方法进行图像复原
2. 仅有噪声图像复原
    - 必须知道噪声的统计特性以及噪声和图像信号的相关情况，这是非常复杂的。在实际应用中，往往假设噪声是白噪声，即它的频谱密度为常数，且与图像不相关。
    - 不同的复原技术需要不同的有关噪声的先验信息，如下面将要讨论的维纳滤波器需要知道噪声的谱密度，而约束最小二乘方滤波需要知道噪声的均值和方差。
3. 噪声概率密度函数的估计
    - 当仅有通过传感器产生的图像可以利用时，常常可以从合理的恒定灰度值的一小部分估计PDF参数
    - 确定PDF对应的噪声种类后，就可计算灰度值的均值和方差。
    - 均值和方差求得后，就可以得到PDF中的参数 a 和 b
    - 参数期望值、方差及 a b确定后，噪声的概率密度函数则唯一确定。

#### 5.4.2 仅有噪声的复原——空间复原

>   几种滤波器种类
    - 均值滤波器：算术均值滤波器、几何均值滤波器、谐波均值滤波器、逆谐波均值滤波器
    - 顺序统计滤波器：中值滤波器、最大值滤波器、最小值滤波器、中点滤波器、修正后的Alpha均值滤波器
    - 自适应滤波器：自适应局部噪声消除滤波器、自适应中值滤波器

##### 均值滤波器

1. 算数均值滤波器
    - 计算窗口内的算术均值
    - 平滑了一幅图像的局部变化
    - 在模糊了结果的同时减少了噪声
2. 几何均值滤波器
    - 计算窗口内的几何均值
    - 平滑度差不多，但细节丢失更少
    - 算出均值滤波器和几何均值滤波器适于处理高斯或均匀分布噪声
3. 谐波均值滤波器
    - $f(x,y) = \frac{mn}{\sum_{(s,t)\in S_{xy}}\frac1{g(s,t)}}$
    - 对于盐噪声效果好，单不适合处理胡椒噪声
    - 善于处理高斯噪声
4. 逆谐波均值滤波器
    - $f(x,y) = \frac{\sum_{(s,t)\in S_{xy}}{g(s,t)^{Q+1}}}{\sum_{(s,t)\in S_{xy}}{g(s,t)^Q}}$
    - Q称为滤波器的阶数。当Q为正数时，用于消除”胡椒“噪声；当Q为负数时，用于消除”盐“噪声，但不能同时消除”椒盐“噪声
    - 当Q=0，逆谐波均值滤波器转换为算术均值滤波器
    - 当Q=-1，逆谐波均值滤波器转变为谐波均值滤波器

##### 统计排序滤波器

1. 统计排序滤波器
    - 统计排序（顺序统计）滤波器是空间域滤波器；
    - 它们的响应基于滤波器包围的图像区域中像素点的排序；
    - 滤波器在任何点的响应由排序结果决定。
2. 中值滤波器
    - 在相同尺寸下，比起均值滤波器引起的模糊少；
    - 对单极或双极脉冲 (椒盐) 噪声非常有效。
    - 适于处理椒盐噪声，通过多次使用小模板，可以获得很好的去噪效果，但多次应用中值滤波器,会使图像模糊。
3. 最大值滤波器
    -  对图像中的亮点敏感；
    - 最大值滤波器对于 “椒” 噪声具有良好消除效果。
    - 最大值滤波器可以去除”胡椒”噪声，但会从黑色物体边缘移走一些黑色像素。
4. 最小值滤波器
    - 对图像中的暗点敏感；
    - 最小值滤波器对于 “盐” 噪声具有良好消除效果。
    - 最小值滤波器可以去除”盐”噪声,但会从亮色物体边缘移走一些白色像素。
5. 中点滤波器：在范围内计算最大值和最小值之间的算数平均值，即取中点值。
    - 结合了顺序统计和求平均
    - 对于高斯和随机分布这类噪声有最好的效果
6. 修正后的alpha均值滤波器
    - 在$S_{xy}$邻域内去掉g(s,t)最高灰度值的d/2和最低灰度值的d/2
    - 当d为0时，退化为算术均值滤波器
    - 当d=(mn-1)/2时，退化为中值滤波器
    - 当d取其他值时，适用于包括多种噪声的情况下，例如高斯噪声和椒盐噪声混合的情况下

##### 自适应局部滤波器

1. 自适应滤波器
    - 行为变化基于由m*n矩形窗口$S_{xy}$定义的区域内图像的统计特性
    - 与前述滤波器相比，性能更优
    - 但也增加了算法复杂性
2. 响应基于：
    - 噪声点的值
    - 噪声方差
    - 区域内部噪声的局部均值
    - 区域内部噪声的平均方差
3. 滤波器的预期性能
    - 如果噪声方差为0，滤波器返回g(x,y)的值。因为在g(x,y)下零噪声的情况等同于f(x,y)
    - 如果局部方差与噪声方差高相关，滤波器返回一个g(x,y)的近似值
    - 如果噪声方差与局部方差相等，那么滤波器返回区域上像素的均值。
4. 基于上述假定的自适应表达式:
    $$
        f(x,y) = g(x,y) - \frac{\sigma_{\eta}^2}{\sigma_{L}^2}[g(x, y) - m_L]
    $$
    其中唯一需要知道或估计的未知量是噪声方差，其余参数均可从$S_{xy}$中的像素计算出来。
5. 自适应中值滤波器
    - 主要目的：
        - 除去“椒盐”噪声（冲激噪声）；
        - 平滑其它非冲激噪声；
        - 减少物体边界细化或粗化等失真。
    - 工作在两个层次，A层和B层

#### 5.4.3 频率域滤波消减周期噪声

1. 周期噪声
    - 周期噪声是在图像获取中从电力或机电干扰中产生 
    - 周期噪声可以通过频率域滤波显著减少
    - 周期噪声趋向于产生频率尖峰，其参数可以通过检测图像的傅里叶谱来进行估计。
2. 图像复原的频率域滤波器
    - 带阻滤波器
    - 带通滤波器
    - 陷波滤波器
3. 带阻滤波器
    - 带阻滤波器：阻止一定频率范围内的信号通过而允许其它频率范围内的信号通过
    - 理想带阻滤波器
    - 巴特沃思带阻滤波器
    - 高斯带阻滤波器
4. 带通滤波器：
    - 允许一定频率范围内的信号通过而阻止其他频率范围内的信号通过: $H_{bp} = 1 - H_{br}(u,v)$
    - $H_{bp}(u,v)$表示带通滤波器，$H_br{u,v}$表示相应的带阻滤波器
    - 带通滤波器执行与带阻滤波器宪法的操作
        - 不直接使用，损失大量图像细节。
        - 可利用带通滤波器提取噪声模式。
5. 陷波滤波器：阻止或通过事先定义的中心频率邻域内的频率
    - 理想陷波滤波器
    - 巴特沃思陷波滤波器
    - 高斯陷波滤波器
    - 注意：由于傅里叶变换是对称的，因此陷波滤波器必须以关于原点对称的形式出现
6. 陷波带阻滤波器
    - 理想陷波带阻滤波器
    - 巴特沃斯陷波带阻滤波器
    - 高斯陷波带阻滤波器
7. 陷播带通滤波器

#### 5.4.4 图像退化——线性、位置不变的退化

##### 概述
1. 线性系统的特点：
    - 线性
    - 可加性：这一性质表明，如果H为线性算子，那么两个输入之和的响应等于两个响应之和。
    - 一致性：这表明如果H为线性算子，任何与常数相乘的输入的响应等于该输入响应乘以相同的常数。
    - 位置不变性：表明图像中任一点的响应只取决于在该点的输入值，与该点的位置无关。
2. 线性系统H完全可有冲激响应来表示
3. 具有加性噪声的线性空间不变退化系统可在空间域被模型化为退化函数（点扩散函数）与图像的卷积并加上噪声。

##### 估计退化函数

1. 图像观察估计法：给定一幅退化图像，但没有退化函数 H的知识，那么估计该函数的方法之一就是收集图像自身的信息：
    - 寻找简单结构的子图像
    - 寻找受噪声影响小的子图像
    - 构造一个估计图像，它与观察的子图像有相同大小和特性。由位置不变的假设，可以由傅里叶变换进行推导。
2. 图像试验估计法：使用与被退化图像设备相似的装置，并得到一个脉冲的冲激响应，可以进行较准确的退化估计：一个脉冲点 -> 成像系统H -> 退化图像
3. 模型估计法：建立退化模型，考虑引起退化的环境因素。
4. 估计退化函数：从基本原理开始推导出退化模型：当成像传感器与被摄景物之间存在足够快的相对运动时，所摄取的图像就会出现“运动模糊”。匀速直线运动造成的模糊，可用数学推导出其退化函数。

#### 5.4.5 逆滤波

1. 基本思想：如果已知系统的传递函数 ，则根据F(u,v) = G(u,v)/H(u,v)可得复原图像的谱，经Fourier逆变换即可得到复原图像。
2. 注意事项：
    - 即使知道退化函数，也不能准确复原图像，因为噪声函数 N(u,v) 是一个随机函数，其傅里叶变换未知。
    - 如果退化是零或非常小的值，噪声即使数值很小，但 N(u,v)/H(u,v)之比 (上式第二项) 可能非常大，很容易决定估计值。
3. 解决退化是零或非常小的值的途径：限制滤波的频率，使其接近原点值。
    - 在离频率平面离原点较远的地方，H(u,v)数值较小或为零。
    - 因此图像复原在原点周围的有限区域内进行，即将退化图像的傅立叶谱限制在没出现零点而且数值又不是太小的有限范围内；
    - 即通过将频率限制为接近原点分析，减少了遇到零值的几率。

#### 5.4.6 最小均方差复原法——Wiener滤波复原

1. 目标：寻找一个滤波器，使得复原后图像 与原始图像的均方误差最小。
2. 维纳滤波器：
    $$
    H_w(u,v) = \frac1{H(u,v)} \frac{|H(u,v)|^2}{|H(u,v)|^2 + S_{\eta}(u,v) / S_f(u,v)}
    $$
3. 维纳滤波需要假定下述条件成立(或近似成立)：
    - 系统为线性、空间不变；
    - 退化图像、原始图像和噪声都是均匀随机场，噪声的均值为零，且与图像不相关。
4. 其他说明
    - 如果噪声为0，其功率谱消失，维纳滤波就退化为逆滤波
    - 未退化图像的功率谱难以知道，可用下式近似表示：
        $$
        H_w(u,v) = \frac1{H(u,v)} \frac{|H(u,v)|^2}{|H(u,v)|^2 + K}
        $$
    其中K是根据信噪比的某种先验知识确定的常数。
3. 维纳滤波的缺点
    - 未退化图像和噪声的功率谱必须是已知的；
    - 功率比(信噪比)常数K 的估计一般还是没有合适的解。

#### 5.4.7 约束最小二乘方滤波器

1. 维纳滤波存在缺点：未退化函数f(x,y)和噪声n(x,y)的功率谱必须是已知的；K值，功率谱比的常数估计一般还是没有合适的解。
2. 如果只求噪声方差和均值，那么就能从给定的退化图像计算出来。
3. 图像退化模型：g(x, y) = h(x, y)*f(x, y) +η(x, y)可用一维列向量表达为：g = Hf +η，结果向量g, f和η是MN×1维，矩阵H有MNxMN维。
4. 最优化公式得以存在的约束条件：欧几里得向量范数.如果要对图像得到最优化的复原效果，需要不停地修正γ值，使得γ值的选取能最终满足约束条件。
5. 表达式：
    $$
    F(u,v) = \frac{H^{*}(u,v)}{|H(u,v)|^2 + \gamma |P(u,v)|^2} G(u,v)
    $$
    当式中$\gamma$未0时，简化为逆滤波公式。

#### 5.4.8 几何均值滤波复原